<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py by Paul Cho - Soomgo Tech</title><meta name="gridsome:hash" content="c670d5ee025030f952f3448986aec25d458077d1"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.19"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="152x152" href="/assets/static/favicon.62d22cb.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="120x120" href="/assets/static/favicon.1539b60.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="167x167" href="/assets/static/favicon.dc0cdc5.f2d543711ef5e20a474f3b69d3d41be5.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="180x180" href="/assets/static/favicon.7b22250.f2d543711ef5e20a474f3b69d3d41be5.png"><link rel="preload" href="/assets/css/0.styles.7d01e712.css" as="style"><link rel="preload" href="/assets/js/app.fa1010ad.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--post-vue.77e0a7ac.js" as="script"><link rel="prefetch" href="/assets/js/8.6a25e241.js"><link rel="prefetch" href="/assets/js/page--node-modules--gridsome--app--pages--404-vue.c9645e1f.js"><link rel="prefetch" href="/assets/js/page--src--pages--about-vue.64179064.js"><link rel="prefetch" href="/assets/js/page--src--pages--index-vue.455be179.js"><link rel="prefetch" href="/assets/js/page--src--templates--author-vue.60778b21.js"><link rel="prefetch" href="/assets/js/page--src--templates--tag-vue.bfe6ca6f.js"><link rel="stylesheet" href="/assets/css/0.styles.7d01e712.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
  </head>
  <body >
    <div data-server-rendered="true" id="app" class="layout"><div class="nav"><nav role="navigation" aria-label="main navigation" class="navbar container nav"><div class="navbar-brand"><a href="/" to="[object Object]" class="navbar-item router-link-active"><img src="/assets/img/soomgo.f2d54371.png" alt="Soomgo"></a><a role="button" aria-label="menu" class="navbar-burger burger"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu"><div class="navbar-start"><a href="/about" to="/about" class="navbar-item">
        About
      </a><a href="https://soomgo.recruitee.com/" class="navbar-item">
        Support
      </a></div><div class="navbar-end"></div></div></nav></div><section class="hero is-medium is-primary"><div class="hero-body"><div class="container"><div class="titles"><h1 class="title is-1">
            숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py
          </h1><h2 class="subtitle">
            About Soomgo-py
          </h2></div></div></div></section><main><div class="box breadcrumbs"><nav aria-label="breadcrumbs" class="breadcrumb is-centered"><ul><li><a href="/" class="router-link-active">Home</a></li><li class="is-active"><a href="#" aria-current="page">숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py</a></li></ul></nav></div><section class="section"><div class="container"><div class="content"><div><p>안녕하세요. 숨고 백엔드 엔지니어 Paul 입니다.</p>
<p>이번 포스팅 에서는 숨고 백엔드 챕터 내부에서 제작한 MSA Architecture를 위한 프레임워크 <strong>Soomgo-py</strong>에 대해 기록하려 합니다.</p>
<p>Soomgo-py는 기본적으로 API 전용 프레임워크인 Falcon을 기반으로 제작 되었고, 현재 이를 이용하여 많은 서비스들이 만들어졌습니다.</p>
<p>숨고의 서비스 규모가 성장하고 요구 사항이 많아지면서 이에 적합한 MSA Architecture를 검토하고 있었고 긴 시간 분석을 통해 숨고 전용의 MSA 프레임워크인 Soomgo-py를 만들어보기로 결정했습니다.</p>
<p>아래는 Soomgo-py 프레임워크가 탄생하게된 대표적인 배경 세 가지입니다.</p>
<ul>
<li>서비스별로 존재하는 중복된 코드 및 모듈</li>
<li>매번 프로젝트를 설정하는 번거로움</li>
<li>낙후되어 관리하기 어려워진 레거시</li>
</ul>
<h1 id="서비스별로-중복된-코드-및-모듈"><a href="#%EC%84%9C%EB%B9%84%EC%8A%A4%EB%B3%84%EB%A1%9C-%EC%A4%91%EB%B3%B5%EB%90%9C-%EC%BD%94%EB%93%9C-%EB%B0%8F-%EB%AA%A8%EB%93%88" aria-hidden="true"><span class="icon icon-link"></span></a>서비스별로 중복된 코드 및 모듈</h1>
<p>업계에 알려진 유명한 이론으로 프레임워크 구축 기준을 제시한 규칙이 있습니다. <em>Rule of Three</em> 라는 이 규칙은 최소 3번 이상 재사용 된다면 프레임워크를 구축할 수 있다는 말입니다.</p>
<p>우리 모두가 알다시피 대부분의 Restful API의 요청/응답은 비슷하게 동작합니다. 이는 재사용 가능한 모듈로 만들어서 관련 인터페이스를 제공할 수 있다는 것을 의미합니다. 특정 리소스를 등록한다는 Post 메소드를 예로 들자면</p>
<ul>
<li>클라이언트가 특정 endpoint로 요청</li>
<li>payload에 대한 validation 이후 비즈니스 로직 수행</li>
<li>처리 결과에 대한 응답</li>
</ul>
<p>대부분의 제품 코드가 이보다 더 복잡할테지만 크게 본다면 위 단계를 벗어나지 않습니다. 이를 위하여 Soomgo-py에서는 장고의 CBV(Class-Based View)와 유사한 컨셉으로 구현하였습니다.</p>
<p>다음의 코드는 Soomgo-py 프레임워크에서 제공한 CreateResource를 사용여 DB에 샘플리소스를 저장하는 소스코드 입니다.</p>
<pre class="language-py"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">SampleCreateResource</span><span class="token punctuation">(</span>CreateResource<span class="token punctuation">)</span><span class="token punctuation">:</span>
model <span class="token operator">=</span> SampleModel
serializer <span class="token operator">=</span> SampleSchema
validation_schema <span class="token operator">=</span> SampleValidationSchema
authentication_classes <span class="token operator">=</span> <span class="token punctuation">[</span>token_authentication<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">serializer_data</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token string">'items'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> o<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span> <span class="token keyword">for</span> o <span class="token keyword">in</span> objects<span class="token punctuation">]</span><span class="token punctuation">}</span></code></pre>
<p>위 코드는 매우 간단한 예제입니다. CreateResource를 상속받아 클래스 속성(Class Attribute) 들을 선언하는 것만으로 특정 리소스를 저장합니다.</p>
<p>물론, 필요하다면 메소드를 오버라이딩하여 확장할 수도 있습니다.</p>
<h1 id="매번-프로젝트를-설정하는-번거로움"><a href="#%EB%A7%A4%EB%B2%88-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%84%A4%EC%A0%95%ED%95%98%EB%8A%94-%EB%B2%88%EA%B1%B0%EB%A1%9C%EC%9B%80" aria-hidden="true"><span class="icon icon-link"></span></a>매번 프로젝트를 설정하는 번거로움</h1>
<p>서비스가 상용(Production) 레벨에서 운용되기 위해 API Endpoint controller만 필요한 게 아닙니다. 숨고에서는 실제로 서비스의 가용성(Availability)을 위해 다양한 도구들을 사용하고 있습니다.</p>
<p>예를 들면, 모니터링을 위한 NewRelic, 이슈 트래킹을 위한 bugsnag 그리고 docker, k8s, black, flake8 등. 이런 모든 도구의 실행을 위해 Soomgo-py에서는 createapp 커맨드를 통해 각 도구의 설정을 자동으로 초기화 해줍니다.</p>
<p>이로인해 엔지니어는 비즈니스 로직 이외에 다른 환경적인 이슈를 신경 쓰지 않아도 됨으로 생산성은 증가하고 실수는 감소합니다. 아래는 createapp 커맨드를 사용하여 프로젝트가 되는 동영상입니다.</p>
<div style="padding:70% 0 0 0;width:100%;position:relative;">
    <iframe src="https://player.vimeo.com/video/474326664?h=4884da4e16" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
</div>
<h1 id="레거시-모델"><a href="#%EB%A0%88%EA%B1%B0%EC%8B%9C-%EB%AA%A8%EB%8D%B8" aria-hidden="true"><span class="icon icon-link"></span></a>레거시 모델</h1>
<p>어느 서비스에나 레거시 모델은 존재합니다. 마찬가지로 숨고에서도 MSA로 옮겨지지 못하고 이전 장고(Python Django)로 구현된 레거시 모델이 존재합니다.</p>
<p>이 레거시 모델을 Soomgo-py에서 관리함으로써 MSA 서비스에서는 더 이상 레거시 모델에 대한 어떠한 관리도 할 필요가 없어졌습니다.</p>
<p>. . .</p>
<p>앞서 언급한 필요성 이외에도 Soomgo-py를 구축한 이유는 다음과 같고 실제로도 같은 이득을 얻고 있습니다.</p>
<ol>
<li>엔지니어의 생산성 증가</li>
<li>일관성 있는 구조 및 코드로 유지보수성 향상</li>
<li>중복 코드 최소화</li>
<li>더 나은 서비스 품질을 위하여</li>
</ol>
<h1 id="soomgo-py-프레임워크의-장점"><a href="#soomgo-py-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%9D%98-%EC%9E%A5%EC%A0%90" aria-hidden="true"><span class="icon icon-link"></span></a>Soomgo-py 프레임워크의 장점</h1>
<p>다음은 Soomgo-py 프레임워크가 가지고 있는 장점입니다.</p>
<ol>
<li><strong>사용성(Usability)</strong>: 훌륭한 프레임워크 일지라도 사용성이 떨어진다면 비즈니스 로직을 구현 함에 있어 장애물이 될 수 있습니다. Soomgo-py는 러닝 커브를 최소화하고자 상세한 문서화, 장고 CBV와 유사한 메소드 및 동작 패턴, Sample 코드 등을 도입하여 사용성을 높였습니다.</li>
</ol>
<p><img src="https://miro.medium.com/max/698/1*VhpqqjUnzyrXoNhdaXNCbg.png"></p>
<p>간단한 파일, 코드 추가로 CLI(Command Line Interface)를 구현할 수 있습니다. 아래 동영상은 test CLI를 추가한 영상입니다.</p>
<div style="padding:70% 0 0 0;width:100%;position:relative;">
    <iframe src="https://player.vimeo.com/video/474518629?h=94a13a3ecd" style="position:absolute;top:0;left:0;width:100%;height:100%;" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>
</div>
<ol start="2">
<li><strong>확장성(Extensibility)</strong>: 다형성을 통해 인터페이스에 대한 확장이 가능하도록 설계 되었고 인터페이스 이외에도 라이브러리에 대한 확장이 가능하도록 설계 되었습니다.</li>
</ol>
<p>예를 들어, WSGI로 Gunicorn를 사용 중인데, 이 외에 Uvicorn을 사용해야 한다면 Settings.WSGI_SERVER의 값을 ‘uvicorn’으로 변경하는 것으로 쉽게 다른 환경을 선택할 수 있습니다.</p>
<pre class="language-py"><code class="language-py"><span class="token keyword">class</span> <span class="token class-name">BaseWSGI</span><span class="token punctuation">(</span>ABC<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">GunicornWSGI</span><span class="token punctuation">(</span>BaseWSGI<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">UvicornASGI</span><span class="token punctuation">(</span>BaseWSGI<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">class</span> <span class="token class-name">WSGIFactor</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@staticmethod</span>
    <span class="token keyword">def</span> <span class="token function">server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">:</span>
        wsgi <span class="token operator">=</span> settings<span class="token punctuation">.</span>WSGI_SERVER
        <span class="token keyword">if</span> wsgi <span class="token operator">==</span> <span class="token string">'gunicorn'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> GunicornWSGI<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> wsgi <span class="token operator">==</span> <span class="token string">'uvicorn'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> UvicornASGI<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> WSGIServerError</code></pre>
<ol start="3">
<li><strong>재사용성(Reusability)</strong>: 재사용 가능한 모듈을 제공함으로써 생산성을 증가 시킵니다. Soomgo-py 안에는 DB Connection polling, Cursor-Based Pagination, Offset-Based Pagination, logging같은 유용한 모듈들이 기본적으로 내장되어 있습니다.</li>
</ol>
<p>Soomgo-py는 외부에 오픈소스로 공개된 프레임워크는 아니지만 교육 목적을 포함한 여러 목적을 위하여 외부에 제공될 가능성이 있습니다.</p>
<p>이후 방향을 고민 해본다면 좀 더 강력한 프레임워크로 발전시키기위해 더 많은 기능(자동 redoc, swagger, async 등)을 추가하여 지속적으로 확장될 예정입니다.</p>
<p>Soomgo-py 프레임워크를 모두가 쓸만하도록 개선하여 오픈소스로 여러분들을 만날 수 있도록 준비하겠습니다. 감사합니다.</p>
</div></div></div></section><div class="box author"><figure class="image is-rounded is-128x128"><img src="../../../../../../uploads/author-images/paul.jpeg" class="is-rounded"></figure><div class="content"><h2 class="title is-5">
        Posted by <a href="/author/paul-cho/">Paul Cho</a></h2><p>Soomgo Backend Engineer</p></div><!----><!----><!----><!----><!----><!----><!----><!----><div class="posts"><div class="next">
        다음 게시글
        <p><a href="/blog/2020/12/09/auto-docs-with-swagger-and-redoc/">
            Swagger와 Redoc을 이용한 API 문서 자동화하기 by Paul Cho</a></p></div><div class="previous">
        이전 게시글
        <p><a href="/blog/2020/09/29/http2-for-all/">
            모두를 위한 Http2 by Kei Jeon
          </a></p></div></div><!----></div></main><footer class="footer"><div class="content has-text-centered"><p>© 2021 SoomgoTech</p><p>
        Powered by GitHub Pages
      </p></div></footer></div>
    <script>window.__INITIAL_STATE__={"data":{"posts":{"edges":[{"node":{"id":"c0689c02660f1b5b932efcf43e65c49a"},"prev":{"path":"\u002Fblog\u002F2021\u002F05\u002F20\u002Fabout-fundamental-of-agile\u002F","title":"애자일의 근본 알아보기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}},"next":null},{"node":{"id":"ae5576a53167114266f6ab8c69cfe19f"},"prev":{"path":"\u002Fblog\u002F2021\u002F04\u002F26\u002Fmobile-app-deploy-automation\u002F","title":"모바일 앱 매주 배포하기: 자동화하기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F10\u002F12\u002Fdd\u002F","title":"dd","author":{"title":"숨고 Soomgo","path":"\u002Fauthor\u002Fsoomgo\u002F"}}},{"node":{"id":"48ed018164c43aeb8996774e3f8f6c22"},"prev":{"path":"\u002Fblog\u002F2021\u002F04\u002F18\u002Fmobile-app-deploy-create-rule\u002F","title":"모바일 앱 매주 배포하기: 규칙 정하기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F05\u002F20\u002Fabout-fundamental-of-agile\u002F","title":"애자일의 근본 알아보기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}}},{"node":{"id":"29c698b6f384ebf2384dbd2640cf91c2"},"prev":{"path":"\u002Fblog\u002F2021\u002F04\u002F16\u002Fsquad-process-and-product-designer\u002F","title":"[Design] 숨고의 애자일, 스쿼드의 업무 프로세스와 프로덕트 디자이너가 하는 일","author":{"title":"Summer Lee","path":"\u002Fauthor\u002Fsummer-lee\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F04\u002F26\u002Fmobile-app-deploy-automation\u002F","title":"모바일 앱 매주 배포하기: 자동화하기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}}},{"node":{"id":"beec0a16612692a60906c5d0794787b2"},"prev":{"path":"\u002Fblog\u002F2021\u002F04\u002F07\u002Fwebsite-benchmark-with-lighthouse\u002F","title":"Lighthouse로 웹사이트 성능 측정하기","author":{"title":"Zoey Kang","path":"\u002Fauthor\u002Fzoey-kang\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F04\u002F18\u002Fmobile-app-deploy-create-rule\u002F","title":"모바일 앱 매주 배포하기: 규칙 정하기","author":{"title":"Jimmy Lee","path":"\u002Fauthor\u002Fjimmy-lee\u002F"}}},{"node":{"id":"b55c21505707bfeb0c3e200227e80b50"},"prev":{"path":"\u002Fblog\u002F2020\u002F12\u002F18\u002Fimprove-kubernetes-cd\u002F","title":"Kubernetes 환경 CD(Continuous Deployment) 개선하기","author":{"title":"Derek","path":"\u002Fauthor\u002Fderek\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F04\u002F16\u002Fsquad-process-and-product-designer\u002F","title":"[Design] 숨고의 애자일, 스쿼드의 업무 프로세스와 프로덕트 디자이너가 하는 일","author":{"title":"Summer Lee","path":"\u002Fauthor\u002Fsummer-lee\u002F"}}},{"node":{"id":"985f56840e2f22845987f529305dfc2f"},"prev":{"path":"\u002Fblog\u002F2020\u002F12\u002F09\u002Fauto-docs-with-swagger-and-redoc\u002F","title":"Swagger와 Redoc을 이용한 API 문서 자동화하기","author":{"title":"Paul Cho","path":"\u002Fauthor\u002Fpaul-cho\u002F"}},"next":{"path":"\u002Fblog\u002F2021\u002F04\u002F07\u002Fwebsite-benchmark-with-lighthouse\u002F","title":"Lighthouse로 웹사이트 성능 측정하기","author":{"title":"Zoey Kang","path":"\u002Fauthor\u002Fzoey-kang\u002F"}}},{"node":{"id":"dda2ca28bab0299deec8a89a846e6d48"},"prev":{"path":"\u002Fblog\u002F2020\u002F11\u002F02\u002Fsoomgo-msa-architecture-soomgo-py\u002F","title":"숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py","author":{"title":"Paul Cho","path":"\u002Fauthor\u002Fpaul-cho\u002F"}},"next":{"path":"\u002Fblog\u002F2020\u002F12\u002F18\u002Fimprove-kubernetes-cd\u002F","title":"Kubernetes 환경 CD(Continuous Deployment) 개선하기","author":{"title":"Derek","path":"\u002Fauthor\u002Fderek\u002F"}}},{"node":{"id":"d7c5f4fc0af185befef675bf903b0cc7"},"prev":{"path":"\u002Fblog\u002F2020\u002F09\u002F29\u002Fhttp2-for-all\u002F","title":"모두를 위한 Http2","author":{"title":"Kei Jeon","path":"\u002Fauthor\u002Fkei-jeon\u002F"}},"next":{"path":"\u002Fblog\u002F2020\u002F12\u002F09\u002Fauto-docs-with-swagger-and-redoc\u002F","title":"Swagger와 Redoc을 이용한 API 문서 자동화하기","author":{"title":"Paul Cho","path":"\u002Fauthor\u002Fpaul-cho\u002F"}}},{"node":{"id":"bb8fc898b05cf4e28cc2cb9252d551dc"},"prev":null,"next":{"path":"\u002Fblog\u002F2020\u002F11\u002F02\u002Fsoomgo-msa-architecture-soomgo-py\u002F","title":"숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py","author":{"title":"Paul Cho","path":"\u002Fauthor\u002Fpaul-cho\u002F"}}}]},"post":{"id":"d7c5f4fc0af185befef675bf903b0cc7","title":"숨고의 MSA Architecture를 위한 프레임워크 Soomgo-py","excerpt":"About Soomgo-py","featuredImage":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F698\u002F1*VhpqqjUnzyrXoNhdaXNCbg.png","content":"\u003Cp\u003E안녕하세요. 숨고 백엔드 엔지니어 Paul 입니다.\u003C\u002Fp\u003E\n\u003Cp\u003E이번 포스팅 에서는 숨고 백엔드 챕터 내부에서 제작한 MSA Architecture를 위한 프레임워크 \u003Cstrong\u003ESoomgo-py\u003C\u002Fstrong\u003E에 대해 기록하려 합니다.\u003C\u002Fp\u003E\n\u003Cp\u003ESoomgo-py는 기본적으로 API 전용 프레임워크인 Falcon을 기반으로 제작 되었고, 현재 이를 이용하여 많은 서비스들이 만들어졌습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E숨고의 서비스 규모가 성장하고 요구 사항이 많아지면서 이에 적합한 MSA Architecture를 검토하고 있었고 긴 시간 분석을 통해 숨고 전용의 MSA 프레임워크인 Soomgo-py를 만들어보기로 결정했습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E아래는 Soomgo-py 프레임워크가 탄생하게된 대표적인 배경 세 가지입니다.\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E서비스별로 존재하는 중복된 코드 및 모듈\u003C\u002Fli\u003E\n\u003Cli\u003E매번 프로젝트를 설정하는 번거로움\u003C\u002Fli\u003E\n\u003Cli\u003E낙후되어 관리하기 어려워진 레거시\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1 id=\"서비스별로-중복된-코드-및-모듈\"\u003E\u003Ca href=\"#%EC%84%9C%EB%B9%84%EC%8A%A4%EB%B3%84%EB%A1%9C-%EC%A4%91%EB%B3%B5%EB%90%9C-%EC%BD%94%EB%93%9C-%EB%B0%8F-%EB%AA%A8%EB%93%88\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E서비스별로 중복된 코드 및 모듈\u003C\u002Fh1\u003E\n\u003Cp\u003E업계에 알려진 유명한 이론으로 프레임워크 구축 기준을 제시한 규칙이 있습니다. \u003Cem\u003ERule of Three\u003C\u002Fem\u003E 라는 이 규칙은 최소 3번 이상 재사용 된다면 프레임워크를 구축할 수 있다는 말입니다.\u003C\u002Fp\u003E\n\u003Cp\u003E우리 모두가 알다시피 대부분의 Restful API의 요청\u002F응답은 비슷하게 동작합니다. 이는 재사용 가능한 모듈로 만들어서 관련 인터페이스를 제공할 수 있다는 것을 의미합니다. 특정 리소스를 등록한다는 Post 메소드를 예로 들자면\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E클라이언트가 특정 endpoint로 요청\u003C\u002Fli\u003E\n\u003Cli\u003Epayload에 대한 validation 이후 비즈니스 로직 수행\u003C\u002Fli\u003E\n\u003Cli\u003E처리 결과에 대한 응답\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E대부분의 제품 코드가 이보다 더 복잡할테지만 크게 본다면 위 단계를 벗어나지 않습니다. 이를 위하여 Soomgo-py에서는 장고의 CBV(Class-Based View)와 유사한 컨셉으로 구현하였습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E다음의 코드는 Soomgo-py 프레임워크에서 제공한 CreateResource를 사용여 DB에 샘플리소스를 저장하는 소스코드 입니다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-py\"\u003E\u003Ccode class=\"language-py\"\u003E\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003ESampleCreateResource\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003ECreateResource\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\nmodel \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E SampleModel\nserializer \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E SampleSchema\nvalidation_schema \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E SampleValidationSchema\nauthentication_classes \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003Etoken_authentication\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\n\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Eserializer_data\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eself\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E objects\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'items'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E[\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'id'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E o\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token builtin\"\u003Eid\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efor\u003C\u002Fspan\u003E o \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E objects\u003Cspan class=\"token punctuation\"\u003E]\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E위 코드는 매우 간단한 예제입니다. CreateResource를 상속받아 클래스 속성(Class Attribute) 들을 선언하는 것만으로 특정 리소스를 저장합니다.\u003C\u002Fp\u003E\n\u003Cp\u003E물론, 필요하다면 메소드를 오버라이딩하여 확장할 수도 있습니다.\u003C\u002Fp\u003E\n\u003Ch1 id=\"매번-프로젝트를-설정하는-번거로움\"\u003E\u003Ca href=\"#%EB%A7%A4%EB%B2%88-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%84%A4%EC%A0%95%ED%95%98%EB%8A%94-%EB%B2%88%EA%B1%B0%EB%A1%9C%EC%9B%80\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E매번 프로젝트를 설정하는 번거로움\u003C\u002Fh1\u003E\n\u003Cp\u003E서비스가 상용(Production) 레벨에서 운용되기 위해 API Endpoint controller만 필요한 게 아닙니다. 숨고에서는 실제로 서비스의 가용성(Availability)을 위해 다양한 도구들을 사용하고 있습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E예를 들면, 모니터링을 위한 NewRelic, 이슈 트래킹을 위한 bugsnag 그리고 docker, k8s, black, flake8 등. 이런 모든 도구의 실행을 위해 Soomgo-py에서는 createapp 커맨드를 통해 각 도구의 설정을 자동으로 초기화 해줍니다.\u003C\u002Fp\u003E\n\u003Cp\u003E이로인해 엔지니어는 비즈니스 로직 이외에 다른 환경적인 이슈를 신경 쓰지 않아도 됨으로 생산성은 증가하고 실수는 감소합니다. 아래는 createapp 커맨드를 사용하여 프로젝트가 되는 동영상입니다.\u003C\u002Fp\u003E\n\u003Cdiv style=\"padding:70% 0 0 0;width:100%;position:relative;\"\u003E\n    \u003Ciframe src=\"https:\u002F\u002Fplayer.vimeo.com\u002Fvideo\u002F474326664?h=4884da4e16\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;\" frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\n\u003C\u002Fdiv\u003E\n\u003Ch1 id=\"레거시-모델\"\u003E\u003Ca href=\"#%EB%A0%88%EA%B1%B0%EC%8B%9C-%EB%AA%A8%EB%8D%B8\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E레거시 모델\u003C\u002Fh1\u003E\n\u003Cp\u003E어느 서비스에나 레거시 모델은 존재합니다. 마찬가지로 숨고에서도 MSA로 옮겨지지 못하고 이전 장고(Python Django)로 구현된 레거시 모델이 존재합니다.\u003C\u002Fp\u003E\n\u003Cp\u003E이 레거시 모델을 Soomgo-py에서 관리함으로써 MSA 서비스에서는 더 이상 레거시 모델에 대한 어떠한 관리도 할 필요가 없어졌습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E. . .\u003C\u002Fp\u003E\n\u003Cp\u003E앞서 언급한 필요성 이외에도 Soomgo-py를 구축한 이유는 다음과 같고 실제로도 같은 이득을 얻고 있습니다.\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E엔지니어의 생산성 증가\u003C\u002Fli\u003E\n\u003Cli\u003E일관성 있는 구조 및 코드로 유지보수성 향상\u003C\u002Fli\u003E\n\u003Cli\u003E중복 코드 최소화\u003C\u002Fli\u003E\n\u003Cli\u003E더 나은 서비스 품질을 위하여\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Ch1 id=\"soomgo-py-프레임워크의-장점\"\u003E\u003Ca href=\"#soomgo-py-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC%EC%9D%98-%EC%9E%A5%EC%A0%90\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003ESoomgo-py 프레임워크의 장점\u003C\u002Fh1\u003E\n\u003Cp\u003E다음은 Soomgo-py 프레임워크가 가지고 있는 장점입니다.\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003E\u003Cstrong\u003E사용성(Usability)\u003C\u002Fstrong\u003E: 훌륭한 프레임워크 일지라도 사용성이 떨어진다면 비즈니스 로직을 구현 함에 있어 장애물이 될 수 있습니다. Soomgo-py는 러닝 커브를 최소화하고자 상세한 문서화, 장고 CBV와 유사한 메소드 및 동작 패턴, Sample 코드 등을 도입하여 사용성을 높였습니다.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F698\u002F1*VhpqqjUnzyrXoNhdaXNCbg.png\"\u003E\u003C\u002Fp\u003E\n\u003Cp\u003E간단한 파일, 코드 추가로 CLI(Command Line Interface)를 구현할 수 있습니다. 아래 동영상은 test CLI를 추가한 영상입니다.\u003C\u002Fp\u003E\n\u003Cdiv style=\"padding:70% 0 0 0;width:100%;position:relative;\"\u003E\n    \u003Ciframe src=\"https:\u002F\u002Fplayer.vimeo.com\u002Fvideo\u002F474518629?h=94a13a3ecd\" style=\"position:absolute;top:0;left:0;width:100%;height:100%;\" frameborder=\"0\" allow=\"autoplay; fullscreen; picture-in-picture\" allowfullscreen\u003E\u003C\u002Fiframe\u003E\n\u003C\u002Fdiv\u003E\n\u003Col start=\"2\"\u003E\n\u003Cli\u003E\u003Cstrong\u003E확장성(Extensibility)\u003C\u002Fstrong\u003E: 다형성을 통해 인터페이스에 대한 확장이 가능하도록 설계 되었고 인터페이스 이외에도 라이브러리에 대한 확장이 가능하도록 설계 되었습니다.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003E예를 들어, WSGI로 Gunicorn를 사용 중인데, 이 외에 Uvicorn을 사용해야 한다면 Settings.WSGI_SERVER의 값을 ‘uvicorn’으로 변경하는 것으로 쉽게 다른 환경을 선택할 수 있습니다.\u003C\u002Fp\u003E\n\u003Cpre class=\"language-py\"\u003E\u003Ccode class=\"language-py\"\u003E\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EBaseWSGI\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EABC\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EGunicornWSGI\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EBaseWSGI\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EUvicornASGI\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003EBaseWSGI\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Eclass\u003C\u002Fspan\u003E \u003Cspan class=\"token class-name\"\u003EWSGIFactor\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token decorator annotation punctuation\"\u003E@staticmethod\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Edef\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Eserver\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eapp\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n        wsgi \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E settings\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003EWSGI_SERVER\n        \u003Cspan class=\"token keyword\"\u003Eif\u003C\u002Fspan\u003E wsgi \u003Cspan class=\"token operator\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'gunicorn'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E GunicornWSGI\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eapp\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Erun\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Eelif\u003C\u002Fspan\u003E wsgi \u003Cspan class=\"token operator\"\u003E==\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'uvicorn'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"token keyword\"\u003Ereturn\u003C\u002Fspan\u003E UvicornASGI\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003Eapp\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003Erun\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\n        \u003Cspan class=\"token keyword\"\u003Eelse\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E:\u003C\u002Fspan\u003E\n            \u003Cspan class=\"token keyword\"\u003Eraise\u003C\u002Fspan\u003E WSGIServerError\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Col start=\"3\"\u003E\n\u003Cli\u003E\u003Cstrong\u003E재사용성(Reusability)\u003C\u002Fstrong\u003E: 재사용 가능한 모듈을 제공함으로써 생산성을 증가 시킵니다. Soomgo-py 안에는 DB Connection polling, Cursor-Based Pagination, Offset-Based Pagination, logging같은 유용한 모듈들이 기본적으로 내장되어 있습니다.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cp\u003ESoomgo-py는 외부에 오픈소스로 공개된 프레임워크는 아니지만 교육 목적을 포함한 여러 목적을 위하여 외부에 제공될 가능성이 있습니다.\u003C\u002Fp\u003E\n\u003Cp\u003E이후 방향을 고민 해본다면 좀 더 강력한 프레임워크로 발전시키기위해 더 많은 기능(자동 redoc, swagger, async 등)을 추가하여 지속적으로 확장될 예정입니다.\u003C\u002Fp\u003E\n\u003Cp\u003ESoomgo-py 프레임워크를 모두가 쓸만하도록 개선하여 오픈소스로 여러분들을 만날 수 있도록 준비하겠습니다. 감사합니다.\u003C\u002Fp\u003E\n","tags":[{"id":"Development"},{"id":"Back-end"}],"author":{"path":"\u002Fauthor\u002Fpaul-cho\u002F","title":"Paul Cho","image":"uploads\u002Fauthor-images\u002Fpaul.jpeg","blurb":"Soomgo Backend Engineer"}}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.fa1010ad.js" defer></script><script src="/assets/js/page--src--templates--post-vue.77e0a7ac.js" defer></script>
  </body>
</html>
